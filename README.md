# redis_ghhh手写Redis分布式锁
此锁满足了独占性、高可用、防死锁、不乱抢、重入性  
![Snipaste_2023-09-26_15-39-01](https://github.com/ghhh901/redis_ghhh/assets/133936264/ddcfdeaa-4834-4804-95b7-9d718748c077)  
通过nginx以轮询的方式访问后端接口的两个微服务，模拟买票，在Redis中存储了所需要的票  
共写了九个版本从v1.0无锁业务迭代到v9.0redisson  
# v1.0-v9.0介绍
## v1.0 
无锁状态，啥也不是
## v2.0
用lock单独加到每一个微服务  
存在问题：单机版加锁配合Nginx和Jmeter压测后，不满足高并发分布式锁的性能要求，出现超卖
## v3.0
用redis的setnx的方式进行加锁  
存在问题：部署了微服务的Java程序机器挂了，代码层面根本没有走到finally这块，没办法保证解锁(无过期时间该key一直存在)，这个key没有被删除，需要加入一个过期时间限定key
## v4.0
在锁上加过期时间  
存在问题：stringRedisTemplate.delete(key);只能自己删除自己的锁，不可以删除别人的，需要添加判断是否是自己的锁来进行操作
## v5.0
判断加锁与解锁是不是同一个客户端，同一个才行，自己只能删除自己的锁，不误删他人的  
存在问题：delete和判断操作不是原子性的
## v6.0
加入lua脚本捏合delete和判断操作使它们变为原子性操作  
存在问题：可重入性问题
## v7.0
利用hash结构解决可重入性问题  
存在问题：没有自动续期功能
## v8.0
加自动续期功能
## v9.0
使用redisson




